{% extends "layout.html" %}
{% block content %}
<style>
  #cart{
    min-height: 78.2vh;
  }

  .free-delivery-banner {
  display: flex;
  align-items: center;
  gap: 1rem;
  background: linear-gradient(135deg, #ffae36, #ff9d2d);
  color: #1a1a1a;
  padding: 1rem 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(255, 157, 45, 0.2);
  margin: 2rem auto 1.5rem;
  width: 90%;
  max-width: 800px;
}

.free-delivery-banner i {
  font-size: 2.2rem;
  color: #1a1a1a;
}

.free-delivery-banner h3 {
  margin: 0;
  font-size: 1.3rem;
  font-weight: bold;
}

.free-delivery-banner p {
  margin: 0.2rem 0 0;
  font-size: 0.95rem;
}


  /* shared button style */
  .btn-orange {
    display:inline-block; padding:.75rem 1.4rem; background:#ff9d2d;
    color:#1a1a1a; font-weight:700; border-radius:8px; text-decoration:none;
    transition:background .3s;
  }
  .btn-orange:hover { background:#ffa94f; }

  /* table */
  .cart-table { width:90%; margin:2rem auto; border-collapse:collapse; }
  .cart-table th, .cart-table td {
    padding:.8rem 1rem; border-bottom:1px solid #333;
    text-align:center; color:#eee;
  }
  .cart-table th { background:#1a1a1a; color:#ffae36; }

  /* empty-cart block */
  .empty-cart {
    min-height:82.5vh; display:flex; flex-direction:column; align-items:center;
    justify-content:center; text-align:center; gap:1rem;
  }
  .empty-cart i { font-size:6rem; color:#ff9d2d; }
  .empty-cart p { font-size:1.25rem; color:#ccc; }

  .qty-bar     { display:inline-flex; align-items:center; gap:.4rem; }
.qty-btn     { background:#ff9d2d;border:none;color:#1a1a1a;
               width:30px;height:30px;font:700 1.2rem/1 sans-serif;
               border-radius:6px;cursor:pointer;transition:background .3s;}
.qty-btn:hover { background:#ffa94f; }
.qty-display { width:32px;text-align:center;font-size:1rem; }

</style>
<div id="cart">
  


  {% if data %}
    <div class="free-delivery-banner">
      <i class="fa-solid fa-truck-fast"></i>
      <div>
        <h3>Free Delivery</h3>
        <p>Enjoy free delivery on this order!</p>
      </div>
    </div>
    <h1 style="text-align:center;color:#ffae36;margin:1.5rem 0">Your Cart</h1>

    <table class="cart-table">
      <tr><th>Roll</th><th>Size</th><th>Qty</th><th>Price (₹)</th><th>Subtotal (₹)</th></tr>

      {% set ns = namespace(unit_price=0, total=0) %}
      {% for roll_key, item in data.items() %}
        {% for size_label, qty in item.size.items() %}

          {% set ns.unit_price = 0 %}
          {% for s in ROLLS_DATA[roll_key.strip()]["sizes"] %}
            {% if s["label"] == size_label %}
              {% set ns.unit_price = s["price"] %}
            {% endif %}
          {% endfor %}

          {% set subtotal = ns.unit_price * qty %}
          {% set ns.total = ns.total + subtotal %}

          <tr>
            <td>{{ item.name }}</td>
            <td>{{ size_label }}</td>
            <td>
              <form method="POST" action="{{ url_for('update_cart', roll_key=roll_key, size=size_label) }}" class="qty-bar">
                {{ csrf_token() if csrf_token is defined }}
                <button name="op" value="dec" class="qty-btn">−</button>
                <span class="qty-display">{{ qty }}</span>
                <button name="op" value="inc" class="qty-btn">+</button>
              </form>
            </td>
            <td>{{ ns.unit_price }}</td>
            <td>{{ subtotal }}</td>
          </tr>
        {% endfor %}
      {% endfor %}
    </table>

    <p style="text-align:right;width:90%;margin:1rem auto 0;font-size:1.3rem;color:#ffae36">
      Total: ₹{{ ns.total }}
    </p>

    <form method="POST" action="{{ url_for('checkout', total = ns.total) }}"
          style="width:90%;margin:2rem auto;text-align:right">
      <button type="submit" class="btn-orange">Checkout</button>
    </form>
  {% else %}
    <div class="empty-cart">
      <i class="fa-solid fa-cart-shopping"></i>
      <p>Your cart is empty</p>
      <a href="{{ url_for('menu') }}" class="btn-orange">Browse Menu</a>
    </div>
  {% endif %}

  </div>
{% endblock %}
